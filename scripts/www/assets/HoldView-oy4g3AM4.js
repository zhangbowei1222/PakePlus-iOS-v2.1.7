import{_ as L,o as U,a as G,b,c as x,d as e,t as l,e as J,n as a,u as c,f as M,F as K,r as O,g as Q,h as n,i as v,j as W}from"./index-Mrxc-rM3.js";import{u as X}from"./fundStore-1OjB7uIJ.js";import{g as w,a as V}from"./format-DZ_smWHi.js";import{g as Y}from"./data-B6_LO-0g.js";const Z={class:"page-content page-transition"},ee={class:"mb-6"},te={class:"flex items-center justify-between mb-3"},se={class:"text-xs px-3 py-1 rounded-full bg-blue-50 text-blue-600 font-medium"},oe={class:"bg-white rounded-xl p-5 card-shadow mb-6"},le={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-2"},ae={class:"bg-gradient-to-br from-blue-50 to-sky-50 rounded-lg p-4 border border-blue-100"},ne={class:"flex items-center justify-between mb-1"},re={class:"text-base font-bold text-blue-600"},ie={class:"bg-gradient-to-br from-emerald-50 to-green-50 rounded-lg p-4 border border-green-100"},de={class:"flex items-center justify-between mb-1"},ue={class:"bg-gradient-to-br from-violet-50 to-purple-50 rounded-lg p-4 border border-purple-100"},ce={class:"bg-gradient-to-br from-amber-50 to-yellow-50 rounded-lg p-4 border border-amber-100"},ve={class:"bg-white rounded-xl p-5 card-shadow mb-6"},fe={key:0,class:"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4"},me={class:"flex items-center text-amber-700 text-sm"},ge={key:1,class:"bg-green-50 border border-green-200 rounded-lg p-3 mb-4"},be={class:"flex items-center text-green-700 text-sm"},xe={class:"space-y-3"},pe=["onClick"],he={class:"flex justify-between items-center mb-1"},ye={class:"flex flex-col"},_e={class:"font-medium"},we={class:"text-xs text-gray-500 mt-1"},Te={class:"grid grid-cols-2 gap-2 text-sm mt-2"},Pe={class:"flex justify-between"},Fe={class:"flex justify-between"},ke={class:"flex justify-between"},Ce={class:"font-medium"},De={class:"flex justify-between"},je={class:"font-medium"},Se={class:"w-full h-1.5 bg-gray-100 rounded-full mt-2"},A=20,Me={__name:"HoldView",setup(Ve){console.log("HoldView: script setup 开始执行");const k=W(),C=X();console.log("HoldView: setup 代码执行完成");const p=n(!0),h=n(!0),D=n(0),y=n(0),i=n(null),_=n(!1),f=n(!1),T=n("数据刷新成功"),r=n(null),d=v(()=>C.holdFunds),H=v(()=>{const s=new Date;return`${s.getMonth()+1}月${s.getDate()}日 星期${["日","一","二","三","四","五","六"][s.getDay()]}`}),j=v(()=>d.value.reduce((s,t)=>s+t.holdAmount,0)),P=v(()=>d.value.reduce((s,t)=>s+t.dayProfit,0)),m=v(()=>d.value.reduce((s,t)=>s+t.holdProfit,0)),F=v(()=>{const s=j.value;return s===0?0:m.value/(s-m.value)*100}),u=s=>s==null?"0.00":Number(s).toFixed(2),$=s=>{const t=parseFloat(s);return t>=0?Math.ceil(t*100)/100:Math.floor(t*100)/100},I=s=>{const t=$(parseFloat(s));return t>=0?`+${t.toFixed(2)}`:`${t.toFixed(2)}`},R=s=>{k.push({name:"FundDetail",params:{code:s.code}})},N=()=>{const s=Date.now(),t=(s-D.value)/1e3;if(t<A){const o=Math.ceil(A-t);y.value=o,_.value=!0,i.value&&clearInterval(i.value),i.value=setInterval(()=>{y.value--,y.value<=0&&(clearInterval(i.value),i.value=null,_.value=!1)},1e3);return}D.value=s,_.value=!1,S()},q=()=>{k.push({name:"SyncHold"})},z=()=>{p.value=!p.value},B=()=>{h.value=!h.value},S=async()=>{if(console.log("zhixing"),!d.value||d.value.length===0){console.log("暂无持有基金，跳过实时数据获取");return}try{const s=d.value.map(o=>o.code),t=await Y(s);t&&t.length>0&&(t.forEach(o=>{const g=C.holdFunds.find(E=>E.code===o.code);g&&(g.change=I(o.change),g.dayProfit=g.holdAmount*(o.change/100))}),T.value=`数据刷新成功，已更新 ${t.length} 支基金`,f.value=!0,r.value&&clearTimeout(r.value),r.value=setTimeout(()=>{f.value=!1},3e3))}catch(s){console.error("批量获取实时数据失败:",s),T.value="数据刷新失败，请稍后重试",f.value=!0,r.value&&clearTimeout(r.value),r.value=setTimeout(()=>{f.value=!1},3e3)}};return U(()=>{console.log("HoldView: onMounted 触发"),S()}),G(()=>{i.value&&clearInterval(i.value),r.value&&clearTimeout(r.value)}),(s,t)=>(b(),x("div",Z,[e("div",ee,[e("div",te,[t[0]||(t[0]=e("div",{class:"flex items-center"},[e("div",{class:"w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 flex items-center justify-center mr-3"},[e("i",{class:"fa fa-user text-white text-sm"})]),e("div",null,[e("div",{class:"text-lg font-bold text-gray-800"},"你好，投资者")])],-1)),e("div",se,l(H.value),1)]),t[1]||(t[1]=J('<div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100" data-v-476fbd62><div class="flex items-start" data-v-476fbd62><i class="fa fa-quote-left text-blue-300 mr-3 mt-1" data-v-476fbd62></i><div class="flex-1" data-v-476fbd62><p class="text-sm text-gray-700" data-v-476fbd62>&quot;投资就像滚雪球，重要的是找到很湿的雪和很长的坡。&quot;</p><p class="text-xs text-gray-500 mt-1" data-v-476fbd62>—— 沃伦·巴菲特</p></div><i class="fa fa-chart-line text-blue-400 ml-2" data-v-476fbd62></i></div></div>',1))]),e("div",oe,[e("div",le,[e("div",ae,[e("div",ne,[t[2]||(t[2]=e("div",{class:"text-sm text-gray-500"},"账户资产",-1)),e("button",{onClick:z,class:"text-xs text-gray-400 hover:text-gray-600"},[e("i",{class:a(p.value?"fa fa-eye-slash":"fa fa-eye")},null,2)])]),e("div",re,l(p.value?u(j.value):"****.**"),1)]),e("div",ie,[e("div",de,[t[3]||(t[3]=e("div",{class:"text-sm text-gray-500"},"当日收益",-1)),e("button",{onClick:B,class:"text-xs text-gray-400 hover:text-gray-600"},[e("i",{class:a(h.value?"fa fa-eye-slash":"fa fa-eye")},null,2)])]),e("div",{class:a(["text-base font-bold",c(w)(P.value)])},l(h.value?(P.value>=0?"+":"")+u(P.value):"****.**"),3)]),e("div",ue,[t[4]||(t[4]=e("div",{class:"text-sm text-gray-500 mb-1"},"持仓盈亏",-1)),e("div",{class:a(["text-base font-bold",c(w)(m.value)])},l(m.value>=0?"+":"")+l(u(m.value)),3)]),e("div",ce,[t[5]||(t[5]=e("div",{class:"text-sm text-gray-500 mb-1"},"收益率",-1)),e("div",{class:a(["text-base font-bold",c(V)(F.value)])},l(F.value>=0?"+":"")+l(F.value.toFixed(2))+"% ",3)])])]),e("div",ve,[e("div",{class:"flex justify-between items-center mb-4"},[t[8]||(t[8]=e("h2",{class:"text-lg font-bold"},"我的持有基金",-1)),e("div",{class:"flex items-center gap-3"},[e("button",{onClick:q,class:"text-primary text-sm flex items-center"},[...t[6]||(t[6]=[e("i",{class:"fa fa-sync mr-1"},null,-1),e("span",null,"同步持仓",-1)])]),e("button",{onClick:N,class:"text-primary text-sm flex items-center"},[...t[7]||(t[7]=[e("i",{class:"fa fa-refresh mr-1"},null,-1),e("span",null,"刷新数据",-1)])])])]),_.value?(b(),x("div",fe,[e("div",me,[t[9]||(t[9]=e("i",{class:"fa fa-exclamation-triangle mr-2"},null,-1)),e("span",null,"请勿频繁刷新，"+l(y.value)+"秒后再试",1)])])):M("",!0),f.value?(b(),x("div",ge,[e("div",be,[t[10]||(t[10]=e("i",{class:"fa fa-check-circle mr-2"},null,-1)),e("span",null,l(T.value),1)])])):M("",!0),e("div",xe,[(b(!0),x(K,null,O(d.value,o=>(b(),x("div",{key:o.code,class:"border-b border-gray-100 pb-3 hover:bg-gray-50 rounded-lg p-2 cursor-pointer fund-item hover-scale",onClick:g=>R(o)},[e("div",he,[e("div",ye,[e("h3",_e,l(o.name),1),e("span",we,l(o.code),1)]),e("span",{class:a([c(V)(o.change),"font-medium px-2 py-1 rounded"])},l(o.change)+"%",3)]),e("div",Te,[e("div",Pe,[t[11]||(t[11]=e("span",{class:"text-neutral"},"当日收益:",-1)),e("span",{class:a([c(w)(o.dayProfit),"font-medium"])},l(u(o.dayProfit)),3)]),e("div",Fe,[t[12]||(t[12]=e("span",{class:"text-neutral"},"持有收益:",-1)),e("span",{class:a([c(w)(o.holdProfit),"font-medium"])},l(u(o.holdProfit)),3)]),e("div",ke,[t[13]||(t[13]=e("span",{class:"text-neutral"},"持有金额:",-1)),e("span",Ce,l(u(o.holdAmount)),1)]),e("div",De,[t[14]||(t[14]=e("span",{class:"text-neutral"},"持有天数:",-1)),e("span",je,l(o.holdDays)+"天",1)])]),e("div",Se,[e("div",{class:a([o.change>=0?"bg-rise":"bg-fall","h-full rounded-full"]),style:Q({width:Math.min(100,50+o.change*5)+"%"})},null,6)])],8,pe))),128))])])]))}},Re=L(Me,[["__scopeId","data-v-476fbd62"]]);export{Re as default};
