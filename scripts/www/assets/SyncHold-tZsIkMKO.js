import{_ as B,w as M,b as s,c as n,d as t,n as p,f as d,k as b,v as g,t as m,F as U,r as V,h as i,j}from"./index-Mrxc-rM3.js";import{u as I}from"./fundStore-1OjB7uIJ.js";import{f as $,s as z}from"./data-B6_LO-0g.js";const H={class:"page-content page-transition"},L={class:"bg-white rounded-xl p-5 card-shadow"},T={class:"flex border-b border-gray-200 mb-4"},G={key:0,class:"upload-panel"},J={key:0,class:"upload-preview mb-4"},Y=["src"],q={key:1,class:"manual-panel"},Q={class:"space-y-4 mb-4"},W={class:"input-group"},X={key:0,class:"mt-1 text-xs text-red-600"},Z={key:1,class:"mt-2 bg-white border border-gray-200 rounded-lg max-h-60 overflow-y-auto"},K=["onClick"],ee={class:"flex justify-between items-center"},te={class:"text-sm font-medium text-gray-900"},oe={class:"text-xs text-gray-500"},le={class:"text-xs text-gray-400"},re={class:"input-group"},ae={key:0,class:"mt-1 text-xs text-red-600"},se={class:"input-group"},ne={key:0,class:"mt-1 text-xs text-red-600"},ue={class:"input-group"},de={key:0,class:"mt-1 text-xs text-red-600"},ie={__name:"SyncHold",setup(me){const _=j(),A=I(),C=()=>{_.go(-1)},c=i("upload"),v=i(null),x=i(""),f=i(null),P=()=>{v.value.click()},N=r=>{const e=r.target.files[0];if(e){if(e.size>5*1024*1024){alert("文件大小不能超过5MB"),v.value.value="",f.value=null;return}f.value=e;const l=new FileReader;l.onload=h=>{x.value=h.target.result},l.readAsDataURL(e)}},F=async()=>{if(!f.value){alert("请先上传图片");return}try{const e=await(h=>new Promise((O,S)=>{const k=new FileReader;k.readAsDataURL(h),k.onload=()=>{const D=k.result.split(",")[1];O(D)},k.onerror=D=>S(D)}))(f.value),l=await $(e);console.log("OCR识别结果：",l),l&&l.data?alert(`OCR识别成功！识别结果：${JSON.stringify(l.data)}`):alert("OCR识别失败，请检查图片清晰度")}catch(r){console.error("OCR识别失败:",r),alert("识别失败："+r.message)}},o=i({name:"",code:"",holdAmount:"",holdProfit:"",holdDays:""}),a=i({name:"",holdAmount:"",holdProfit:"",holdDays:""}),y=i(""),u=i([]);M(y,async r=>{if(console.log("newKeyword:",r),console.log("searchResults:",u),r&&r.trim().length>=2)try{const e=await z(r.trim());e.data&&e.data.Datas?u.value=e.data.Datas:u.value=[]}catch(e){console.error("搜索基金失败:",e),u.value=[]}else u.value=[]});const R=r=>{o.value.name=r.NAME,o.value.code=r.CODE,y.value=r.NAME,u.value=[]},w=()=>{o.value={name:"",code:"",holdAmount:"",holdProfit:"",holdDays:""},y.value="",u.value=[]},E=async()=>{a.value={name:"",holdAmount:"",holdProfit:"",holdDays:""};let r=!1;if(o.value.name||(a.value.name="请输入基金名称",r=!0),(!o.value.holdAmount||isNaN(o.value.holdAmount)||Number(o.value.holdAmount)<=0)&&(a.value.holdAmount="请输入有效的持有金额",r=!0),(o.value.holdProfit===""||isNaN(o.value.holdProfit))&&(a.value.holdProfit="请输入有效的持有收益",r=!0),(!o.value.holdDays||isNaN(o.value.holdDays)||o.value.holdDays<=0)&&(a.value.holdDays="请输入有效的持有天数",r=!0),r)return;const e={code:o.value.code,name:o.value.name,holdAmount:Number(o.value.holdAmount),holdProfit:Number(o.value.holdProfit),holdDays:Number(o.value.holdDays)};A.addHoldFund(e),w(),f.value=null,x.value="",v.value&&(v.value.value="")};return(r,e)=>(s(),n("div",H,[t("div",{class:"flex items-center justify-between mb-6"},[t("button",{onClick:C,class:"text-gray-600 flex items-center"},[...e[7]||(e[7]=[t("i",{class:"fa fa-arrow-left mr-2"},null,-1),t("span",{class:"text-sm"},"返回",-1)])]),e[8]||(e[8]=t("h1",{class:"text-xl font-bold"},"同步持仓",-1)),e[9]||(e[9]=t("div",{class:"w-8"},null,-1))]),t("div",L,[t("div",T,[t("button",{onClick:e[0]||(e[0]=l=>c.value="upload"),class:p(["py-2 px-4 text-sm font-medium border-b-2 transition-colors",c.value==="upload"?"text-primary border-primary":"text-gray-500 border-transparent"])}," 截图上传 ",2),t("button",{onClick:e[1]||(e[1]=l=>c.value="manual"),class:p(["py-2 px-4 text-sm font-medium border-b-2 transition-colors",c.value==="manual"?"text-primary border-primary":"text-gray-500 border-transparent"])}," 手动输入 ",2)]),c.value==="upload"?(s(),n("div",G,[t("div",{onClick:P,class:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-primary transition-colors mb-4"},[e[10]||(e[10]=t("i",{class:"fa fa-cloud-upload text-3xl text-gray-400 mb-2"},null,-1)),e[11]||(e[11]=t("p",{class:"text-gray-500 text-sm"},"点击上传持仓页截图",-1)),e[12]||(e[12]=t("p",{class:"text-gray-400 text-xs mt-1"},"支持JPG/PNG格式，最大5MB",-1)),t("input",{ref_key:"fileInput",ref:v,type:"file",accept:"image/jpeg,image/png",class:"hidden",onChange:N},null,544)]),x.value?(s(),n("div",J,[e[13]||(e[13]=t("p",{class:"text-sm text-gray-600 mb-2"},"预览:",-1)),t("img",{src:x.value,class:"rounded-lg w-full h-auto max-h-60 object-contain",alt:"持仓截图"},null,8,Y)])):d("",!0),t("button",{onClick:F,class:"w-full bg-primary text-white py-2 rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors"}," 识别并同步 ")])):d("",!0),c.value==="manual"?(s(),n("div",q,[t("div",Q,[t("div",W,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"基金名称/代码",-1)),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>y.value=l),type:"text",class:p(["w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-1 focus:border-primary",a.value.name?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-primary"]),placeholder:"请输入基金名称或代码搜索"},null,2),[[g,y.value]]),a.value.name?(s(),n("p",X,m(a.value.name),1)):d("",!0),u.value.length>0?(s(),n("div",Z,[(s(!0),n(U,null,V(u.value,l=>(s(),n("div",{key:l.CODE,onClick:h=>R(l),class:"px-3 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0"},[t("div",ee,[t("div",null,[t("div",te,m(l.NAME),1),t("div",oe,m(l.CODE),1)]),t("div",le,m(l.TYPE),1)])],8,K))),128))])):d("",!0),b(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.name=l),type:"hidden"},null,512),[[g,o.value.name]])]),t("div",re,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"持有金额 (元)",-1)),b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.holdAmount=l),type:"number",step:"0.01",class:p(["w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-1 focus:border-primary",a.value.holdAmount?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-primary"]),placeholder:"请输入持有金额"},null,2),[[g,o.value.holdAmount]]),a.value.holdAmount?(s(),n("p",ae,m(a.value.holdAmount),1)):d("",!0)]),t("div",se,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"持有收益 (元)",-1)),b(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.holdProfit=l),type:"number",step:"0.01",class:p(["w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-1 focus:border-primary",a.value.holdProfit?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-primary"]),placeholder:"请输入持有收益"},null,2),[[g,o.value.holdProfit]]),a.value.holdProfit?(s(),n("p",ne,m(a.value.holdProfit),1)):d("",!0)]),t("div",ue,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"持有天数 (天)",-1)),b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.holdDays=l),type:"number",class:p(["w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-1 focus:border-primary",a.value.holdDays?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-primary"]),placeholder:"请输入持有天数"},null,2),[[g,o.value.holdDays]]),a.value.holdDays?(s(),n("p",de,m(a.value.holdDays),1)):d("",!0)])]),t("div",{class:"flex space-x-3"},[t("button",{onClick:E,class:"flex-1 bg-primary text-white py-2 rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors"}," 添加持仓 "),t("button",{onClick:w,class:"flex-1 bg-gray-100 text-gray-700 py-2 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors"}," 重置 ")])])):d("",!0)])]))}},fe=B(ie,[["__scopeId","data-v-c738244c"]]);export{fe as default};
